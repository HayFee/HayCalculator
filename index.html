<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HayCalculator</title>
  </head>

  <body>
    <p id="text-display" class="text-display">#####</p>
    <button class="number" onclick="handleNumber(this)">1</button>
    <button class="number" onclick="handleNumber(this)">2</button>
    <button class="number" onclick="handleNumber(this)">3</button>
    <br />
    <button class="number" onclick="handleNumber(this)">4</button>
    <button class="number" onclick="handleNumber(this)">5</button>
    <button class="number" onclick="handleNumber(this)">6</button>
    <br />
    <button class="number" onclick="handleNumber(this)">7</button>
    <button class="number" onclick="handleNumber(this)">8</button>
    <button class="number" onclick="handleNumber(this)">9</button>
    <br />
    <button class="number" onclick="handleNumber(this)">.</button>
    <button class="number" onclick="handleNumber(this)">0</button>
    <button class="operator" onclick="handleEquals()">=</button>
    <br />
    <button class="operator" onclick="handleOperator(this)">+</button>
    <button class="operator" onclick="handleOperator(this)">-</button>
    <button class="operator" onclick="handleOperator(this)">*</button>
    <button class="operator" onclick="handleOperator(this)">/</button>
    <br />
    <button class="clear" onclick="clearAC()">AC</button>
    <button class="clear" onclick="clearC()">C</button>
  </body>

  <script>
    const memory = [];
    let number_buffer = "";
    let operator_buffer = "";

    function handleNumber(n) {
      let num = n.innerHTML;

      // add decimal
      if (num === "." && number_buffer.includes(".")) {
        return null;
      }

      // multiple 0s filter
      if (num === "0" && number_buffer === "0") {
        return null;
      }

      // new number, operator decided
      if (operator_buffer != "") {
        memory.push(operator_buffer);
        clearOpBuffer();
      }

      number_buffer = number_buffer + num; // concatenate typed number to buffer
    }

    function handleOperator(o) {
      let op = o.innerHTML;

      //typed number decided
      if (number_buffer.length != 0) {
        memory.push(Number(number_buffer));
        clearNumBuffer();
      }

      operator_buffer = op; // assign buffer
    }

    function handleEquals() {
      updateDisplay(evalMemory());
    }

    function clearC() {
      // clears most recent number or operator
      memory.pop();
    }

    function clearAC() {
      // clears all memory and display
      while (memory.length > 0) {
        memory.pop();
      }
      clearNumBuffer();
      clearOpBuffer();
      updateDisplay();
    }

    //TODO
    function evalMemory() {
      // calculates result of memory
      return eval(memory.join(""));
    }

    function updateDisplay(value = 0) {
      document.getElementById("text-display").textContent = value;
    }

    function clearNumBuffer() {
      number_buffer = "";
    }

    function clearOpBuffer() {
      operator_buffer = "";
    }
  </script>
</html>
